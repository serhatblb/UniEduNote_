{% extends "base.html" %}
{% block title %}Yeni Åifre Belirle{% endblock %}
{% block content %}
<style>
.auth-box{max-width:400px;margin:80px auto;background:#fff;padding:2rem;border-radius:16px;box-shadow:0 4px 15px rgba(0,0,0,0.08);text-align:center;}
input{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;margin-bottom:1rem;}
button{width:100%;background:linear-gradient(135deg,#00205B,#001540);color:#fff;border:none;border-radius:8px;padding:10px;cursor:pointer;}
.msg{margin-top:1rem;}
</style>

<div class="auth-box">
  <h2>ğŸ”‘ Yeni Åifre Belirle</h2>
  <form id="confirmForm">
    <input type="password" id="password" placeholder="Yeni Åifre" required>
    <button type="submit">Åifreyi GÃ¼ncelle</button>
  </form>
  <p id="msg" class="msg"></p>
</div>

<script>
const params=new URLSearchParams(window.location.search);
const uid=params.get("uid");
const token=params.get("token");
document.getElementById("confirmForm").addEventListener("submit",async(e)=>{
  e.preventDefault();
  const password=document.getElementById("password").value;
  const msg=document.getElementById("msg");
  msg.style.color="#555";msg.innerText="â³ GÃ¼ncelleniyor...";
  try{
    const res=await fetch("/api/auth/password/reset/confirm/",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({uid,token,password})
    });
    const data=await res.json();
    if(res.ok){
      msg.style.color="green";
      msg.innerText="âœ… Åifre baÅŸarÄ±yla gÃ¼ncellendi.";
      setTimeout(()=>window.location.href="/login/",1500);
    }else{
      msg.style.color="red";
      msg.innerText="âš ï¸ "+(data.error||"BaÄŸlantÄ± geÃ§ersiz.");
    }
  }catch{msg.style.color="red";msg.innerText="âš ï¸ Sunucu hatasÄ±.";}
});
</script>
{% endblock %}
