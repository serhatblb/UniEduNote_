{% extends "base.html" %}
{% block title %}Yeni ≈ûifre Belirle{% endblock %}
{% block content %}
<style>
  .auth-box{
    max-width:400px;margin:80px auto;background:#fff;padding:2rem;
    border-radius:20px;box-shadow:0 4px 15px rgba(0,0,0,0.06);text-align:center;
  }
  .auth-box input{
    width:100%;padding:10px;border:1px solid #cbd5f5;
    border-radius:12px;margin-bottom:1rem;font-size:0.95rem;
  }
  .auth-box button{
    width:100%;background:linear-gradient(135deg,#00205B,#001540);color:#fff;
    border:none;border-radius:12px;padding:10px;cursor:pointer;font-weight:600;
  }
  .auth-box .msg{margin-top:1rem;font-size:0.9rem;}
</style>

<div class="glass auth-box">
  <h2>üîë Yeni ≈ûifre Belirle</h2>
  <form id="confirmForm">
    <input type="password" id="password" placeholder="Yeni ≈ûifre" required>
    <button type="submit">≈ûifreyi G√ºncelle</button>
  </form>
  <p id="msg" class="msg"></p>
</div>

<script>
const uid = "{{ uid }}";
const token = "{{ token }}";
document.getElementById("confirmForm").addEventListener("submit",async(e)=>{
  e.preventDefault();
  const password=document.getElementById("password").value;
  const msg=document.getElementById("msg");
  msg.style.color="#555";msg.innerText="‚è≥ G√ºncelleniyor...";
  try{
    const res=await fetch("/api/auth/password/reset/confirm/",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({uid,token,password})
    });
    const data=await res.json();
    if(res.ok){
      msg.style.color="green";
      msg.innerText="‚úÖ ≈ûifre ba≈üarƒ±yla g√ºncellendi.";
      setTimeout(()=>window.location.href="/login/",1500);
    }else{
      msg.style.color="red";
      msg.innerText="‚ö†Ô∏è "+(data.error||"Baƒülantƒ± ge√ßersiz.");
    }
  }catch{msg.style.color="red";msg.innerText="‚ö†Ô∏è Sunucu hatasƒ±.";}
});
</script>
{% endblock %}